{% extends 'base.html.twig' %}

{% block body %}

    <div class="container-fluid" id="formulaire1">

        <div class="col-lg-4 col-sm-8 col-md-8 mx-auto col-12" id="search-address-wrap">
            <form action="" method="POST" id="form">

                <div class="col-lg-12 col-sm-12 col-md-12 mx-auto col-12">
                    <label for="name"><h2>Recherchez un Nom</h2></label><br>
                    <input style="text-align: center" class="form-control" type="text" id="name" name="name" placeholder="Entrez un nom..." autofocus><br><br>
                </div>

                <div class="col-lg-12 col-sm-12 col-md-12 mx-auto col-12">
                    <label for="adress"><h2>Rechercher une adresse</h2></label><br>
                    <input style="text-align: center" class="form-control" type="text" id="adress" name="adress" placeholder="Entrez une adresse..." autofocus><br><br>
                </div>

                <button id="search-btn" type="submit" class="animated bounceInLeft btn btn-success btn-lg" name="button"><i class="fa fa-search" aria-hidden="true"></i>
                     Rechercher</button>
                <br><br>
                <button class="animated bounceInRight btn btn-danger btn-lg"><a style="color: #FFFFFF; padding: 0.5em" href="/report/new"><i class="fa fa-flag" aria-hidden="true"></i>
                        Signaler une adresse</a>
                </button>
            </form>
        </div>
        <br>
        <div class="row">
            <div class="col-12 col-sm-12 col-md-12 col-lg-10 mx-auto">
                <div id="result" class="alert"></div>
            </div>
            <div class="col-10 mx-auto" id="map"></div>
        </div>

        <br>

        <p class="alert alert-info col-4 mx-auto">Pour consulter les Précautions d'usage, cliquez <a href=".model-id2" data-toggle="modal">içi</a></p>
        <div tabindex="-1" class="modal fade model-id2" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 style="text-decoration: underline">Ce site est un site officiel, développé par les services de l’État dans le Rhône.</h2>
                    </div>
                    <div style="text-align: left" class="modal-body">
                        <p><span style="color: green">Il permet </span>de vérifier, pour un établissement recevant du public donné, s’il satisfait à ses obligations réglementaires en termes d’accessibilité aux personnes en situation de handicap par une démarche menée dans le Rhône : <ul><li>soit par une attestation de conformité.</li><li>soit par un agenda d’accessibilité programmée (Ad’AP) validé par le préfet à travers lequel le propriétaire ou l’exploitant s’est engagé à rendre conforme l’établissement dans un délai donné.</li></ul>
                            <span style="font-weight: bold">AUCUN CONTRÔLE SUR PLACE DES ELEMENTS DECLARATIFS CONTENUS DANS CES DOCUMENTS N’EST EXERCE PAR L’ADMINISTRATION.</span>
                        </p>
                        <p><span style="color: red">Il ne permet pas :</span><ul><li>de connaître les établissements entièrement accessibles : un établissement bénéficiant de dérogations pour les aspects ne respectant pas la réglementation est considéré comme conforme ;</li><li>de connaître l’intégralité des établissements du département du Rhône ayant satisfait à leurs obligations : certains ont pu faire l’objet d’un dépôt de documents en préfecture du siège régional ou du siège social.</li></ul></p>
                        <hr style="height: 1px">
                        <p><span style="font-weight: bold">ATTENTION</span> : ce site est en construction. Malgré tous nos efforts, il est possible que certaines fonctionnalités fonctionnent mal et que certaines données soient incomplètes ou aient fait l’objet d’une erreur de saisie. Merci de nous aider à l’améliorer en signalant tout bug ou erreur sur le nom ou l’adresse de l’ERP.</p>

                        <p>Vous êtes gestionnaire ou propriétaire d’un établissement et vous n’avez déposé ni attestation ni  Ad’AP ? Tout savoir pour régulariser votre situation <a href="http://www.rhone.gouv.fr/Politiques-publiques/Amenagement-du-territoire-urbanisme-construction-logement/Accessibilite/Accessibilite-des-Etablissements-Recevant-du-Public-ERP">ici</a>.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>


    <script>


        $(function() {

            $('#form').on('submit', function() {
                var result = $('#result')
                var address = document.getElementById('adress').value
                var name = document.getElementById('name').value
                data = address ? address : null
                if(!data) data = name ? name : null
                data = data.split("|")[1]
                $.ajax({
                    method: 'post',
                    url: '',
                    data: {data : data},
                    dataType: 'json',
                    success: function(data) {
                        result.html(data.message)
                        switch (data.status) {
                            case 'ok':
                                result.removeClass('alert-danger')
                                result.addClass('alert-success')
                                console.log(result)
                                break
                            case 'ko':
                                result.removeClass('alert-success')
                                result.addClass('alert-danger')
                                console.log(result)
                                break
                        }
                    },
                    error: function(data) {
                        console.log(data)
                    }
                })
                return false;
            })
        })

        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 16,
                center: {lat: 45.750000, lng: 4.850000}
            });

            document.getElementById('search-btn').addEventListener('click', function() {
                var geocoder = new google.maps.Geocoder();
                geocodeAddress(geocoder, map);
            });
        }

        function geocodeAddress(geocoder, resultsMap) {
            var address = document.getElementById('adress').value
            var name = document.getElementById('name').value
            data = address ? address : null
            if(!data) data = name ? name : null
            data = data.split("|")[1]
            geocoder.geocode({'address': data}, function(results, status) {
                if (status === 'OK') {
                    resultsMap.setCenter(results[0].geometry.location);
                    new google.maps.Marker({
                        map: resultsMap,
                        position: results[0].geometry.location
                    });
                } else {
                }
            });
        }
    </script>

{% endblock  %}

